#!/bin/bash

function displayStartMessage() {
	echo "Usage: control <command> [options]"
	echo "$(cat ./.project/config/logo)"
	echo ""
	echo "Commands:"
	echo "   control start            Start the development environment"
	echo "   control stop             Stop the development environment"
	echo "   control install          Install necessary components of the development environment"
	echo "   control build            Build the development environment"
	echo "   control clean            Remove dangling docker images"
	echo ""
	echo "GitCloud v$(cat ./.project/version)"
}

function ensureConfig() {
    DIR="$HOME/.editor_config/"
    if [ -d "$DIR" ]; then
        mkdir ~/.editor_config &> /dev/null
        mkdir ~/.editor_config/extensions &> /dev/null
        touch ~/.editor_config/settings.json &> /dev/null
    fi
}

function envup() {
  local file=$([ -z "$1" ] && echo ".env" || echo ".env.$1")

  if [ -f "$file" ]; then
    set -a
    source $file
    set +a
  else
    echo "No $file file found" 1>&2
    return 1
  fi
}

function executeCommand() {
	if [ -f ./.project/scripts/"$1".sh ]; then
		bash .project/internal/spinner.sh ./.project/scripts/"$1".sh
	else
		displayStartMessage
	fi
}

ensureConfig && \
envup && \
executeCommand "$1"